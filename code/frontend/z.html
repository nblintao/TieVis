<!DOCTYPE html>
<html>
<head>
    <title>Large Graphs Visualizer</title>
<script type="text/javascript" src="js/esl.js"></script>
<!-- <script type="text/javascript" src="js/zrender.js"></script> -->
<script type="text/javascript" src="data/icoord.js"></script>
<script type="text/javascript" src="data/iedges.js"></script>
</script>
</head>
<body>
<div id="Main" style="width:600px;height:400px;"></div>
<script>


require.config({
    packages: [
        {
            name: 'zrender',
            location: 'js/zrender',
            main: 'zrender'
        }
    ]
});

var w = window.innerWidth - 16;
var h = window.innerHeight - 16;
var pi = Math.PI;
var main = document.getElementById('Main');

main.style.width = w + 'px';
main.style.height = h + 'px';

require(['zrender','zrender/shape/Circle','zrender/shape/Line'], function(zrender,CircleShape,LineShape){
    var zr = zrender.init( main );

var getMyLine = function(xStart,yStart,xEnd,yEnd){
    var l = new LineShape({
        style : {
            xStart : xStart,
            yStart : yStart,
            xEnd : xEnd,
            yEnd : yEnd,
            strokeColor : 'gray',
            lineWidth : 2
            // lineType : 'dashed',    // default solid
            // text : 'line'
        },
        zlevel: -1,
        draggable:true
    });
    return l;
}
var getMyCircle = function(px,py,rad){
    var c = new CircleShape({
        style : {
            x : px,
            y : py,
            r : rad,
            // brushType : 'both',
            color : 'rgba(220, 20, 60, 0.8)',          // rgba supported
            // strokeColor : color.getColor(colorIdx++),  // getColor from default palette
            // lineWidth : 5,
            // text :'circle',
            // textPosition :'inside'
        },
        hoverable : true,   // default true
        draggable : true,   // default false
        clickable : true   // default false

        // // 可自带任何有效自定义属性
        // _name : 'Hello~',
        // onclick: function(params){
        //     alert(params.target._name);
        // },

        // // 响应事件并动态修改图形元素
        // onmousewheel: function(params){
        //     var eventTool = require('zrender/tool/event');
        //     var delta = eventTool.getDelta(params.event);
        //     var r = params.target.style.r;
        //     r += (delta > 0 ? 1 : -1) * 10;
        //     if (r < 10) {
        //         r = 10;
        //     };
        //     zr.modShape(params.target.id, {style: {r: r}})
        //     zr.refresh();
        //     eventTool.stop(params.event);
        // }
        /* 封装支持事件，见shape/base, config.EVENT
        onmousemove : function(e){console.log('onmousemove',e)},
        onmouseover : function(e){console.log('onmouseover',e)},
        onmouseout  : function(e){console.log('onmouseout',e)},
        onmousedown : function(e){console.log('onmousedown',e)},
        onmouseup   : function(e){console.log('onmouseup',e)},
        ondragstart : function(e){console.log('ondragstart',e)},
        ondragend   : function(e){console.log('ondragend',e)},
        ondragenter : function(e){console.log('ondragenter',e)},
        ondragover  : function(e){console.log('ondragover',e)},
        ondragleave : function(e){console.log('ondragleave',e)},
        ondrop      : function(e){console.log('ondrop',e)}
        */
    });

    return c;
}


var start=new Date();
console.log("start timing");

function TimerPoint(desc){
    var now = new Date();
    console.log(desc + ': ' + (now - start) + ' ms');
    start = now;
}

/*************************************************/

// var offset = 200;
// var circleList = [];
// for (var i = 0; i < 3000; i++) {
//     var circle = two.makeCircle(-offset,-offset,5);
//     circle.fill = '#FF8000';
//     // circle.noStroke();
//     circle.stroke = 'grey';
//     circleList.push(circle);
//     frontGroup.add(circle);
// };

// TimerPoint('Build Circles');


/*************************************************/

xcoord = icoord.map(function(d){return d[0]});
ycoord = icoord.map(function(d){return d[1]});
// console.log(xcoord,ycoord);
var maxx = Math.max.apply(null,xcoord),
    minx = Math.min.apply(null,xcoord),
    scax = w/(maxx - minx),
    maxy = Math.max.apply(null,ycoord),
    miny = Math.min.apply(null,ycoord),
    scay = h/(maxy - miny);

// console.log(two.width);
TimerPoint('Get Scale');


/*************************************************/

for (var i = icoord.length - 1; i >= 0; i--) {
    var d = icoord[i];
    // circleList[i].translation.set(scax*(d[0]-minx),scay*(d[1]-miny));

zr.addShape(getMyCircle(scax*(d[0]-minx),scay*(d[1]-miny),5));


};
TimerPoint('Move Circles');

/*************************************************/


for (var i = iedges.length - 1; i >= 0; i--) {
    var d = iedges[i];
    // var line = lineList[i];
    var x1 = scax*(icoord[d[0]][0]-minx),
        y1 = scay*(icoord[d[0]][1]-miny),
        x2 = scax*(icoord[d[1]][0]-minx),
        y2 = scay*(icoord[d[1]][1]-miny);

    zr.addShape(getMyLine(x1,y1,x2,y2));
};
TimerPoint('Move Lines');
/*************************************************/

zr.render();
TimerPoint('Update');

/*************************************************/

    // var N = 10;
    // var color = require('zrender/tool/color');
    // var colorId = 0;

    // for (var i = 0; i < N ; i ++) {
    //     createShape(i);
    // }  
    // zr.render();

    // function createShape(i) {
    //     var id = require('zrender/tool/guid')();
    //     var ShapeClass = ( i % 5 == 0 ) ? TrocholdShape : RoseShape;
    //     var r = ( i % 5 == 0 ) ? random(50, 20) : [random(100, 30)];
        
    //     var shape = new ShapeClass({
    //         id : id,
    //         position : [random(w), random(h)],
    //         style : {
    //             x : 0,
    //             y : 0,
    //             r : r,
    //             r0 : random(20, 10),
    //             d : random(100),
    //             k : random(10),
    //             n : random(5),
    //             location : ['in', 'out'][i % 2],
    //             lineWidth : 1,
    //             strokeColor :  color.getColor(colorId ++)
    //         },
    //         rotation : [pi * 2 / random(360), 0, 0],
    //         hoverable : false,
    //         draggable : false
    //     });
    //     zr.addShape(shape);
    //     animate(id, shape.type);
    // }

    // function animate(id, shape) {
    //     var time = random(1000, 100);
    //     var type = shape =='rose' ? random(6) : random(3);
    //     var easing = [
    //         'Linear', 'QuadraticIn', 'QuadraticOut', 'QuadraticInOut', 
    //         'CubicIn', 'CubicOut', 'CubicInOut', 'QuarticIn', 'QuarticOut', 
    //         'QuarticInOut', 'QuinticIn', 'QuinticOut', 'QuinticInOut',  'SinusoidalIn', 
    //         'SinusoidalOut', 'SinusoidalInOut', 'ExponentialIn', 'ExponentialOut', 
    //         'ExponentialInOut', 'CircularIn', 'CircularOut', 'CircularInOut', 
    //         'ElasticIn', 'ElasticOut', 'ElasticInOut', 'BackIn', 'BackOut', 
    //         'BackInOut', 'BounceIn', 'BounceOut', 'BounceInOut'
    //         ][0]//[random(30)];

    //     var move = zr.animate(id, '');

    //     switch (type) {
    //         case 0 :
    //             move.when(time, {
    //                 scale : [random(3, 1), random(3, 1)]
    //             });
    //             break;
    //         case 1 :
    //             move.when(time, {
    //                 position : [random(w), random(h)]
    //             });
    //             break;
    //         case 2 :
    //             move.when(time, {
    //                 rotation : [pi * 2 * random(10, 1), 0, 0]
    //             });
    //             break;
    //         case 3 : 
    //             move = zr.animate(id, 'style').when(time, {
    //                 r : [random(100, 30)]
    //             });
    //             break;
    //         case 4 : 
    //             move = zr.animate(id, 'style').when(time, {
    //                 k : random(10)
    //             });
    //             break;
    //         case 5 : 
    //             move = zr.animate(id, 'style').when(time, {
    //                 n : random(5)
    //             });
    //             break;
    //     }

    //     move.done(function() {
    //             animate(id, shape);
    //         })
    //         .start(easing);
    // }
})

function random(max, min) {
    var min = min || 0;
    return Math.floor(Math.random() * (max - min)) % (max - min) + min;
}

</script>
</body>
</html>